# ハンカチ落としオンラインゲーム 要件定義書

## 1. プロジェクト概要

### 1.1 目的
リアルタイムで対戦できるオンライン「ハンカチ落とし」ゲームを開発する。2名のプレイヤーがドロップ役とチェック役を交互に担当し、ポイントを競い合う。

### 1.2 ターゲットユーザー
- オンラインで友人と遊びたいユーザー
- シンプルな対戦ゲームを楽しみたいユーザー
- 幅広い年齢層（子供から大人まで）

### 1.3 開発方針
- MVP（最小実行製品）として開発
- 無料サービスのみで開始し、段階的にスケール可能な設計
- シンプルで直感的なUIを優先

## 2. ゲームルール

### 2.1 基本ルール
1. 2人のプレイヤーがドロップ役とチェック役に分かれる
2. ドロップ役はハンカチを落とすかどうか、いつ落とすかを決める（0秒〜1分の間）
3. チェック役は「振り向く」タイミングを選び、ハンカチが落とされているか確認する
4. ハンカチを落としてから振り向くまでの時間がドロップ役のポイントになる
5. 振り向いた時点でハンカチが落とされていない場合、ドロップ役は最大ポイント（60ポイント）を獲得
6. ドロップ役とチェック役を交互に担当し、先に一定ポイント（例：100ポイント）に達したプレイヤーが勝利

### 2.2 詳細ルール
- ハンカチは手から離れてから床に完全に落ちるまで1秒かかる
- チェック役は1ラウンドに1回だけ確認可能
- ドロップ役がハンカチを落としたかどうかは、チェック役が確認した時点で初めて分かる
- 1ラウンドの制限時間は60秒
- ポイント計算：
  - ハンカチ落下完了時間からチェック時間までの経過秒数がポイント
  - 最大60ポイント（1分間チェックしなかった場合）

## 3. 機能要件

### 3.1 ユーザーインターフェース
- ロビー画面：ルーム作成/参加機能
- ゲーム画面：
  - ドロップ役UI：ハンカチを落とすボタン、残り時間表示
  - チェック役UI：振り向くボタン、残り時間表示
- 結果画面：ラウンド結果、累積ポイント表示

### 3.2 ゲームプレイ機能
- 2人のプレイヤーによるリアルタイム対戦
- 役割の自動切り替え（ラウンド終了後）
- タイマー機能（60秒カウントダウン）
- ポイント計算と表示
- 勝敗判定

### 3.3 通信機能
- リアルタイムのプレイヤー間通信
- ルーム管理（作成、参加、退出）
- ネットワーク遅延対策

### 3.4 その他の機能
- プレイヤー名設定（任意）
- 簡易チャット機能（優先度低）
- リプレイ機能（優先度低）

## 4. 非機能要件

### 4.1 パフォーマンス
- レスポンス時間：アクション実行からサーバー処理まで500ms以内
- 同時接続数：初期MVP段階で100〜200ユーザー対応

### 4.2 セキュリティ
- クライアント側改ざん防止
- サーバー側でのタイミング検証
- 基本的なDDoS対策

### 4.3 可用性
- 24時間稼働
- 計画的なメンテナンス時間のみダウンタイム許容

### 4.4 スケーラビリティ
- 初期：無料プランでのサービス提供
- 中期：有料プランへの移行（低コスト）
- 長期：複数サーバーインスタンスによる水平スケーリング

## 5. 技術スタック

### 5.1 フロントエンド
- React.js
- React Context + useReducer（状態管理）
- Socket.io Client（リアルタイム通信）
- Tailwind CSS（ユーティリティファーストCSSフレームワーク）

### 5.2 バックエンド
- Node.js + Express
- Socket.io Server
- インメモリストレージ（将来的にRedisに移行可能な設計）

### 5.3 デプロイ環境
- フロントエンド：Vercel（無料プラン）
- バックエンド：Railway（無料枠）

## 6. 開発スケジュール

### 6.1 フェーズ1：MVP開発（2-3週間）
- 基本ゲームロジック実装
- UI/UX設計と実装
- Socket.io通信実装
- 最小限のエラーハンドリング

### 6.2 フェーズ2：テストとデバッグ（1週間）
- 内部テスト
- バグ修正
- パフォーマンス調整

### 6.3 フェーズ3：ローンチ準備（1週間）
- デプロイ環境設定
- 最終テスト
- 初期リリース

## 7. リスクと対策

### 7.1 技術的リスク
- ネットワーク遅延によるゲーム体験低下
  - 対策：サーバー側でのタイムスタンプ管理と遅延補正
- 同時接続数増加によるパフォーマンス低下
  - 対策：段階的なスケーリングプランの用意

### 7.2 ユーザー体験リスク
- ルールの理解しづらさ
  - 対策：直感的なUI設計とチュートリアル
- マッチング待ち時間の長さ
  - 対策：シンプルなルーム作成・参加システム

## 8. 今後の拡張可能性

### 8.1 追加機能
- ユーザーアカウント管理
- ランキングシステム
- カスタマイズ要素（キャラクター、効果音等）
- 観戦モード

### 8.2 収益モデル（将来的検討）
- カスタマイズアイテム販売
- プレミアム機能

## 9. 成功指標

### 9.1 KPI
- 月間アクティブユーザー数
- 平均プレイ時間
- リテンション率（翌日・翌週）
- 機能ごとの使用率

### 9.2 目標値（MVP段階）
- 月間アクティブユーザー：300人
- 平均プレイ時間：15分/セッション
- リテンション率：初日〜2日目 30%
